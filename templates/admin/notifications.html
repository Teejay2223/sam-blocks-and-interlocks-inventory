{% extends 'base.html' %}
{% block title %}Notifications Management{% endblock %}
{% block content %}
<div class="container mt-4">
  <h3 class="mb-4"><i class="bi bi-bell"></i> Notifications Management</h3>

  <!-- Email Configuration Info -->
  <div class="row g-3 mb-4">
    <div class="col-md-12">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="bi bi-info-circle"></i> Email Configuration</h5>
        </div>
        <div class="card-body">
          <p><strong>Email Server:</strong> {{ config.MAIL_SERVER }}</p>
          <p><strong>From Address:</strong> {{ config.MAIL_DEFAULT_SENDER }}</p>
          <div class="alert alert-warning">
            <strong>Note:</strong> To enable email notifications, set the following environment variables:
            <ul>
              <li><code>MAIL_USERNAME</code> - Your email address</li>
              <li><code>MAIL_PASSWORD</code> - Your email password or app password</li>
              <li><code>MAIL_SERVER</code> (optional, defaults to Gmail)</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0"><i class="bi bi-envelope-check"></i> Test Email</h5>
        </div>
        <div class="card-body">
          <p>Send a test email to verify your configuration is working.</p>
          <form method="POST" action="{{ url_for('test_email') }}">
            <div class="mb-3">
              <label class="form-label">Email Address</label>
              <input type="email" name="email" class="form-control" 
                     value="{{ current_user.email }}" required>
            </div>
            <button type="submit" class="btn btn-success w-100">
              <i class="bi bi-send"></i> Send Test Email
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-warning text-dark">
          <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Low Stock Alert</h5>
        </div>
        <div class="card-body">
          <p>Check inventory and send low stock alerts to admin email.</p>
          <form method="POST" action="{{ url_for('check_low_stock') }}">
            <button type="submit" class="btn btn-warning w-100">
              <i class="bi bi-boxes"></i> Check & Notify Low Stock
            </button>
          </form>
          <small class="text-muted mt-2 d-block">
            Sends notification if any products are at or below reorder level.
          </small>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0"><i class="bi bi-credit-card"></i> Payment Reminders</h5>
        </div>
        <div class="card-body">
          <p>Send payment reminders to customers with outstanding balances.</p>
          <form method="POST" action="{{ url_for('send_payment_reminders') }}" 
                onsubmit="return confirm('Send payment reminders to all customers with outstanding balances?');">
            <button type="submit" class="btn btn-danger w-100">
              <i class="bi bi-envelope-exclamation"></i> Send Reminders
            </button>
          </form>
          <small class="text-muted mt-2 d-block">
            Sends email to all customers with unpaid orders.
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Automated Notifications Info -->
  <div class="row g-3 mb-4">
    <div class="col-md-12">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-lightning"></i> Automated Notifications</h5>
        </div>
        <div class="card-body">
          <p>The following notifications are sent automatically:</p>
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Event</th>
                  <th>Recipient</th>
                  <th>Description</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><i class="bi bi-cart-check text-success"></i> New Order</td>
                  <td>Customer</td>
                  <td>Confirmation email when order is placed</td>
                  <td><span class="badge bg-info">Configured</span></td>
                </tr>
                <tr>
                  <td><i class="bi bi-cash-coin text-success"></i> Payment Received</td>
                  <td>Customer</td>
                  <td>Receipt when payment is recorded</td>
                  <td><span class="badge bg-info">Configured</span></td>
                </tr>
                <tr>
                  <td><i class="bi bi-exclamation-triangle text-warning"></i> Low Stock</td>
                  <td>Admin</td>
                  <td>Alert when inventory is low (manual trigger)</td>
                  <td><span class="badge bg-info">Configured</span></td>
                </tr>
                <tr>
                  <td><i class="bi bi-credit-card text-danger"></i> Payment Reminder</td>
                  <td>Customer</td>
                  <td>Reminder for outstanding balance (manual trigger)</td>
                  <td><span class="badge bg-info">Configured</span></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="alert alert-success mt-3">
            <strong>ðŸ’¡ Pro Tip:</strong> Order confirmation and payment receipt emails will be sent automatically 
            when you process orders and payments in the system (requires email configuration).
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Setup Guide -->
  <div class="row g-3 mb-4">
    <div class="col-md-12">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0"><i class="bi bi-gear"></i> Quick Setup Guide</h5>
        </div>
        <div class="card-body">
          <h6>Gmail Setup (Recommended):</h6>
          <ol>
            <li>Enable 2-Factor Authentication on your Gmail account</li>
            <li>Generate an App Password: <a href="https://myaccount.google.com/apppasswords" target="_blank">myaccount.google.com/apppasswords</a></li>
            <li>Set environment variables on Railway/Render:
              <ul>
                <li><code>MAIL_USERNAME=your-email@gmail.com</code></li>
                <li><code>MAIL_PASSWORD=your-app-password</code></li>
              </ul>
            </li>
            <li>Restart your application</li>
            <li>Click "Send Test Email" to verify setup</li>
          </ol>
          <h6 class="mt-3">For Local Development:</h6>
          <p>Set environment variables in your terminal or .env file:</p>
          <pre class="bg-light p-2">export MAIL_USERNAME="samventuresblocksinterlocks@gmail.com"
export MAIL_PASSWORD="your-app-password"</pre>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
