{% extends 'base.html' %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
<h3 class="mb-3">Admin Dashboard</h3>

<!-- Minimal, no charts; only safe counts and links -->
<div class="row gy-3">
  <div class="col-md-3">
    <div class="card p-3 h-100">
      <h6 class="text-muted">Total products</h6>
      <div class="display-6">{{ total_products or 0 }}</div>
      <a class="btn btn-sm btn-primary mt-2" href="{{ url_for('admin_products') }}">Manage</a>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3 h-100">
      <h6 class="text-muted">Total customers</h6>
      <div class="display-6">{{ total_customers or 0 }}</div>
      <a class="btn btn-sm btn-primary mt-2" href="{{ url_for('admin_customers') }}">Manage</a>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3 h-100">
      <h6 class="text-muted">Total sales</h6>
      <div class="display-6">{{ total_sales or 0 }}</div>
      <a class="btn btn-sm btn-primary mt-2" href="{{ url_for('admin_sales') }}">Manage</a>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3 h-100">
      <h6 class="text-muted">Pending payments</h6>
      <div class="display-6">{{ pending_payments or 0 }}</div>
      <a class="btn btn-sm btn-primary mt-2" href="{{ url_for('payments_list') }}">Manage</a>
    </div>
  </div>
</div>

<h5 class="mt-4">Quick Links</h5>
<div class="row gy-2">
  <div class="col-md-3"><a class="btn btn-outline-secondary w-100" href="{{ url_for('admin_raw_materials') }}">Raw Materials</a></div>
  <div class="col-md-3"><a class="btn btn-outline-secondary w-100" href="{{ url_for('trips') }}">Trips</a></div>
  <div class="col-md-3"><a class="btn btn-outline-secondary w-100" href="{{ url_for('sales_report') }}">Sales Report</a></div>
  <div class="col-md-3"><a class="btn btn-outline-secondary w-100" href="{{ url_for('admin_routes') }}">All Routes</a></div>
  <div class="col-md-3"><a class="btn btn-outline-secondary w-100" href="{{ url_for('admin_audit') }}">Audit Log</a></div>
  <div class="col-md-3"><a class="btn btn-outline-secondary w-100" href="{{ url_for('admin_reconciliation') }}">Reconciliation</a></div>
  <div class="col-md-3"><a class="btn btn-outline-success w-100" href="{{ url_for('admin_health') }}">Health Check</a></div>
</div>

<div class="row mt-4">
  <div class="col-md-6">
    <h6>Low stock products</h6>
    {% if low_products %}
      <ul class="list-group">
      {% for p in low_products %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          {{ p['name'] if 'name' in p.keys() else p.name }}
          <span class="badge bg-danger">{{ (p['qty'] if 'qty' in p.keys() else p.qty) or 0 }} (reorder {{ (p['reorder_level'] if 'reorder_level' in p.keys() else p.reorder_level) or 0 }})</span>
        </li>
      {% endfor %}
      </ul>
    {% else %}
      <div class="alert alert-success mb-0">No low stock products</div>
    {% endif %}
  </div>
  <div class="col-md-6">
    <h6>Low raw materials</h6>
    {% if low_materials %}
      <ul class="list-group">
      {% for m in low_materials %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          {{ m['name'] if 'name' in m.keys() else m.name }}
          <span class="badge bg-danger">{{ (m['qty'] if 'qty' in m.keys() else m.qty) or 0 }} (reorder {{ (m['reorder_level'] if 'reorder_level' in m.keys() else m.reorder_level) or 0 }})</span>
        </li>
      {% endfor %}
      </ul>
    {% else %}
      <div class="alert alert-success mb-0">No low raw materials</div>
    {% endif %}
  </div>
</div>
{% endblock %}